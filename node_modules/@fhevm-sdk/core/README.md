# @fhevm-sdk/core

[![npm version](https://badge.fury.io/js/@fhevm-sdk%2Fcore.svg)](https://www.npmjs.com/package/@fhevm-sdk/core)
[![License: BSD-3-Clause-Clear](https://img.shields.io/badge/License-BSD--3--Clause--Clear-blue.svg)](https://opensource.org/licenses/BSD-3-Clause-Clear)
[![Documentation](https://img.shields.io/badge/docs-guide-brightgreen)](https://github.com/lausuarez02/fhevm-react-template/blob/main/USAGE.md)
[![Examples](https://img.shields.io/badge/examples-working-orange)](https://github.com/lausuarez02/fhevm-react-template/tree/main/packages/examples)

Core FHEVM SDK - universal encryption and execution engine for Fully Homomorphic Encryption on EVM chains.

## üåê Works Everywhere

Node.js ‚Ä¢ React ‚Ä¢ Next.js ‚Ä¢ React Native ‚Ä¢ Express ‚Ä¢ Hardhat ‚Ä¢ Any JavaScript Environment

## üìö Documentation & Examples

- **[üìñ Complete Usage Guide](https://github.com/lausuarez02/fhevm-react-template/blob/main/USAGE.md)** - All environments (Next.js, React, Node.js, React Native, Express, Hardhat)
- **[ü§ñ AI Context Guide](https://github.com/lausuarez02/fhevm-react-template/blob/main/AI-CONTEXT.md)** - Optimized for AI assistants (Claude, GPT-4, etc.)
- **[üìÅ Node.js Example](https://github.com/lausuarez02/fhevm-react-template/tree/main/packages/examples/node-demo)** - Full working example
- **[üìÅ Next.js Example](https://github.com/lausuarez02/fhevm-react-template/tree/main/packages/examples/nextjs-demo)** - Full working example

## Installation

```bash
npm install @fhevm-sdk/core
# or
pnpm add @fhevm-sdk/core
# or
yarn add @fhevm-sdk/core
```

## Quick Start

```typescript
import { initFHEVM, encryptInput, executeEncrypted } from '@fhevm-sdk/core';
import { ethers } from 'ethers';

// Initialize SDK
await initFHEVM({
  network: 'localhost', // or 'sepolia', 'mainnet'
});

// Encrypt input
const encrypted = await encryptInput({
  contract: '0x...',
  schema: { age: 'uint8' },
  values: { age: 25 },
  user: '0x...',
});

// Execute encrypted transaction
const provider = new ethers.JsonRpcProvider('http://localhost:8545');
const signer = await provider.getSigner();

const result = await executeEncrypted({
  signer,
  contract: '0x...',
  abi: contractABI,
  functionName: 'submitAge',
  encrypted,
});

console.log('Transaction hash:', result.hash);
```

## API Reference

### Core Functions

| Function | Description |
|----------|-------------|
| `initFHEVM(config)` | Initialize FHEVM SDK with network configuration |
| `getFHEVM()` | Get current FHEVM context |
| `encryptInput(params)` | Encrypt input values according to schema |
| `executeEncrypted(params)` | Execute encrypted transaction |
| `waitForDecryption(params)` | Wait for decryption event |
| `userDecrypt(params)` | Decrypt with user signature (EIP-712) |
| `publicDecrypt(params)` | Public decrypt via relayer |

### Configuration

```typescript
interface FHEVMConfig {
  network: 'localhost' | 'sepolia' | 'mainnet' | 'custom';
  aclAddress?: string;        // Auto-resolved from network presets
  kmsVerifierAddress?: string;
  gatewayUrl?: string;
  provider?: Provider;
}
```

### Encryption Schema

Supported types:
- `uint8`, `uint16`, `uint32`, `uint64`
- `address`
- `bytes`

```typescript
const encrypted = await encryptInput({
  contract: '0x...',
  schema: {
    amount: 'uint32',
    recipient: 'address',
  },
  values: {
    amount: 1000,
    recipient: '0x...',
  },
  user: '0x...',
});
```

## Error Handling

```typescript
import { SDKError, SDKErrorCode } from '@fhevm-sdk/core';

try {
  await encryptInput({ ... });
} catch (error) {
  if (error instanceof SDKError) {
    switch (error.code) {
      case SDKErrorCode.NOT_INITIALIZED:
        // Handle not initialized
        break;
      case SDKErrorCode.ENCRYPTION_FAILED:
        // Handle encryption failure
        break;
    }
  }
}
```

## Network Presets

The SDK includes built-in presets for:
- `localhost` - Local development
- `sepolia` - Sepolia testnet
- `mainnet` - Ethereum mainnet

Custom networks:

```typescript
await initFHEVM({
  network: 'custom',
  aclAddress: '0x...',
  kmsVerifierAddress: '0x...',
  gatewayUrl: 'https://...',
});
```

## License

BSD-3-Clause-Clear
